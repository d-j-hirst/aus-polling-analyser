## Guide to Python scripts

### General

The script fp_model.py will likely not work natively under Windows due to its dependence on the pystan module. However it can be run on a Windows machine using [WSL](https://docs.microsoft.com/en-us/windows/wsl/install), which is recommended both for it and other scripts in this directory.

Make sure to prepare the virtual environment before attempting to run the scripts.

To do this enter the following console commands in this directory. These lines only need to be entered once:

```
python3 -m venv env
pip3 install -r requirements.txt
```

This will install the required Python modules as listed by `requirements.txt` in the folder `env`.

Then, to activate the virtual environment (each time a new console is opened), use the following line.

```
source env/bin/activate
```

(If you have your own preferred environment manager or naming system, it is of course fine to modify the above if you know what you're doing.)

### fp_model.sh

This generates the poll trend from poll data and other information. This process takes a while to complete, possibly from 1-4 hours depending on processor speed and the specifics of the data for the election. For each election following generation of the poll trend, three files are created for each party, generic "Others" (including most minor parties but not the Greens) and a TPP measure. The three files contain information for the actual trend, a record of the polls used (including their house-effect-adjusted value), and a record of the house effect estimates. These are saved in the `/Outputs` subdirectory.

Standard use is as follows (example is for the 2022 federal election, replace with the year and lower-case state code for other elections)

```
python3 fp_model.py --election 2022-fed
```

Use `--election all` to generate poll trends for all elections at once (note this takes a very long time, likely multiple days to complete):

```
python3 fp_model.py --election all
```

Use (e.g.) `--election 2016-fed-onwards` to generate poll trends for a particular election *and all subsequent ones*. This is useful if you were trying to generate all poll trends but were interrupted:

```
python3 fp_model.py --election 2016-fed-onwards
```

### trend_adjust.sh

This takes the poll trends generated by `fp_model.sh` and compares with historic election results to create a table of trend adjustments based on the number of days before the election. These are saved in the `/Adjustments` subdirectory. Note that this is usually done targeting a specific election; this prevents that election's data from being used to create the analysis so that an appropriate hindcast can be made for past elections.

Standard use is as follows (example is targeting the 2022 federal election, replace with the year and lower-case state code for other elections)

```
python3 trend_adjust.py --election 2022-fed
```

## Other notes

### File permission issues

If having problems with file permissions in WSL2, try following commands, replacing any c/C with the drive letter you're using (if not C):
- sudo umount /mnt/c
- sudo mount -t drvfs C: /mnt/c -o metadata

### Quick setup for running code

To quickly set up the system, copy all subfolders in the "Archives" subfolder, and paste them into its parent "analysis" folder (i.e. the folder this Readme is in.)
Note that it's still recommended to run the whole generation process to keep everything up to date, as the archived files may not include recent changes.